#pragma once
double ComputeFractionalKelly(int totalTrades,int wins,double avgWin,double avgLoss,double baseRiskPercent,double kellyFraction,double maxFraction,int minTradesRequired){if(totalTrades<minTradesRequired||avgWin<=0||avgLoss<=0) return baseRiskPercent;double p=(double)wins/totalTrades;double q=1.0-p;double b=avgWin/avgLoss;double fullKelly=p - q / b;if(fullKelly<=0) return baseRiskPercent;double frac=fullKelly*kellyFraction;if(frac>maxFraction) frac=maxFraction;double overlayRisk=baseRiskPercent*(frac/(fullKelly));if(overlayRisk>baseRiskPercent) overlayRisk=(baseRiskPercent+overlayRisk)/2.0;return overlayRisk;}