#pragma once
bool ScalingVolatilityGate(const string sym,ENUM_TIMEFRAMES LTF,ENUM_TIMEFRAMES MTF,ENUM_TIMEFRAMES HTF,double ltfShortATRPeriod,double ltfLongATRPeriod,double mtfShortATRPeriod,double mtfLongATRPeriod,double htfShortATRPeriod,double htfLongATRPeriod,double maxAllowedRatioLTF,double maxAllowedRatioMTF,double maxAllowedRatioHTF){auto atrRatio=[&](ENUM_TIMEFRAMES tf,int sP,int lP)->double{double s=0,l=0;for(int i=0;i<lP;i++){double hi=iHigh(sym,tf,i),lo=iLow(sym,tf,i);double pc=(i>0)?iClose(sym,tf,i+1):iClose(sym,tf,i);double tr=MathMax(hi-lo,MathMax(MathAbs(hi-pc),MathAbs(lo-pc)));if(i<sP) s+=tr;l+=tr;}if(sP>0) s/=sP;if(lP>0) l/=lP;if(l<=0) return 1.0;return s/l;};double ratioLTF=atrRatio(LTF,(int)ltfShortATRPeriod,(int)ltfLongATRPeriod);double ratioMTF=atrRatio(MTF,(int)mtfShortATRPeriod,(int)mtfLongATRPeriod);double ratioHTF=atrRatio(HTF,(int)htfShortATRPeriod,(int)htfLongATRPeriod);bool allow=(ratioLTF<=maxAllowedRatioLTF)&&(ratioMTF<=maxAllowedRatioMTF)&&(ratioHTF<=maxAllowedRatioHTF);return allow;}